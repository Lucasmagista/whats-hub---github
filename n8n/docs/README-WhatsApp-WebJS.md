<div align="center">

# ğŸ¤– WhatsApp Web.js + n8n Chatbot

<img src="https://img.shields.io/badge/WhatsApp-25D366?style=for-the-badge&logo=whatsapp&logoColor=white" alt="WhatsApp">
<img src="https://img.shields.io/badge/n8n-FF6D5A?style=for-the-badge&logo=n8n&logoColor=white" alt="n8n">
<img src="https://img.shields.io/badge/Node.js-43853D?style=for-the-badge&logo=node.js&logoColor=white" alt="Node.js">
<img src="https://img.shields.io/badge/OpenAI-412991?style=for-the-badge&logo=openai&logoColor=white" alt="OpenAI">

**Sistema completo e avanÃ§ado para criar chatbots WhatsApp inteligentes**  
*Processamento de texto, Ã¡udio, imagem, vÃ­deo com IA de Ãºltima geraÃ§Ã£o*

[ğŸš€ InÃ­cio RÃ¡pido](#-inÃ­cio-rÃ¡pido) â€¢ [ğŸ“– DocumentaÃ§Ã£o](#-instalaÃ§Ã£o-completa) â€¢ [ğŸ¯ Exemplos](#-exemplos-prÃ¡ticos) â€¢ [ğŸ†˜ Suporte](#-suporte)

---

### â­ **Principais CaracterÃ­sticas**

</div>

<table align="center">
<tr>
<td align="center">ğŸ§ <br><b>IA AvanÃ§ada</b><br>GPT-4, Whisper, Vision</td>
<td align="center">ğŸ’¬<br><b>Multi-mÃ­dia</b><br>Texto, Ãudio, Imagem, VÃ­deo</td>
<td align="center">ğŸ”„<br><b>Tempo Real</b><br>Respostas instantÃ¢neas</td>
<td align="center">ğŸ†“<br><b>Gratuito</b><br>Sem custos de API</td>
</tr>
</table>

## ğŸŒŸ Funcionalidades Completas

### ğŸ¯ **Sistema de Atendimento AvanÃ§ado**

| Funcionalidade | DescriÃ§Ã£o | Status |
|---------------|-----------|--------|
| ğŸ¤– **Bot Inteligente** | Fluxos conversacionais automatizados | âœ… Pronto |
| ğŸ‘¥ **Atendimento Humano** | Fila de atendimento com mÃºltiplos atendentes | âœ… Pronto |
| ğŸ“Š **Dashboard** | Monitoramento em tempo real da fila e chats | âœ… Pronto |
| ğŸ”„ **APIs REST** | Controle completo via API | âœ… Pronto |
| ğŸ“ˆ **Analytics** | MÃ©tricas e estatÃ­sticas detalhadas | âœ… Pronto |
| ğŸ’¾ **PersistÃªncia** | Estados salvos com backup automÃ¡tico | âœ… Pronto |

### ğŸ¯ **Processamento Inteligente de MÃ­dia**

| Tipo de Mensagem | Capacidade | Tecnologia | Status |
|------------------|------------|------------|--------|
| ğŸ’¬ **Texto** | ConversaÃ§Ã£o natural com IA | GPT-4 Turbo | âœ… Pronto |
| ğŸµ **Ãudio/Voz** | TranscriÃ§Ã£o em tempo real | OpenAI Whisper | âœ… Pronto |
| ğŸ–¼ï¸ **Imagens** | AnÃ¡lise visual e OCR | GPT-4 Vision | âœ… Pronto |
| ğŸ¬ **VÃ­deos** | ExtraÃ§Ã£o de frames e anÃ¡lise | Custom AI Pipeline | âœ… Pronto |
| ğŸ“„ **Documentos** | ExtraÃ§Ã£o e resumo de texto | OCR + GPT-4 | âœ… Pronto |
| ğŸ“ **LocalizaÃ§Ã£o** | Processamento de coordenadas | Maps API | ğŸ”§ ConfigurÃ¡vel |

### ğŸ§  **Recursos de IA AvanÃ§ados**

#### ğŸ­ **Personalidades do Bot**
- ğŸ¤– **Assistente TÃ©cnico**: Suporte especializado
- ğŸ‘¥ **Atendimento**: Foco em customer service
- ğŸ“ **Educativo**: ExplicaÃ§Ãµes didÃ¡ticas
- ğŸ˜„ **Casual**: ConversaÃ§Ã£o descontraÃ­da
- ğŸ’¼ **Profissional**: ComunicaÃ§Ã£o corporativa

#### ğŸ› ï¸ **Ferramentas Integradas**
- ğŸ“š **Wikipedia**: Consultas enciclopÃ©dicas
- ğŸŒ **Web Search**: Busca em tempo real
- ğŸ“Š **Calculadora**: OperaÃ§Ãµes matemÃ¡ticas
- ğŸŒ¤ï¸ **Clima**: PrevisÃ£o meteorolÃ³gica
- ğŸ“ˆ **CotaÃ§Ãµes**: PreÃ§os de aÃ§Ãµes e crypto
- ğŸ—“ï¸ **Agenda**: Gerenciamento de eventos

### ğŸ’¡ **Recursos TÃ©cnicos**

#### ğŸ”„ **Sistema de MemÃ³ria**
```
â”Œâ”€ Conversa Individual â”€â”    â”Œâ”€ Contexto Global â”€â”    â”Œâ”€ Aprendizado â”€â”
â”‚ â€¢ HistÃ³rico pessoal   â”‚    â”‚ â€¢ PreferÃªncias    â”‚    â”‚ â€¢ PadrÃµes     â”‚
â”‚ â€¢ PreferÃªncias        â”‚ â†â†’ â”‚ â€¢ ConfiguraÃ§Ãµes   â”‚ â†â†’ â”‚ â€¢ Melhorias   â”‚
â”‚ â€¢ Estado da conversa  â”‚    â”‚ â€¢ Dados do usuÃ¡rioâ”‚    â”‚ â€¢ AdaptaÃ§Ã£o   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”— **Arquitetura do Sistema**
```
ğŸ“± WhatsApp â†â†’ ğŸ”„ Web.js â†â†’ ğŸŒ Webhook â†â†’ ğŸ“Š n8n â†â†’ ğŸ¤– IA â†â†’ ğŸ“¤ Resposta
     â†‘                                                        â†“
ğŸ“Š Analytics â†â†’ ğŸ’¾ Database â†â†’ ğŸ§  Memory â†â†’ ğŸ› ï¸ Tools â†â†’ ğŸ“ˆ Metrics
```

## ğŸ“‹ PrÃ©-requisitos

- Node.js 16+ 
- n8n instalado e rodando
- Conta OpenAI (para IA e transcriÃ§Ã£o)
- WhatsApp pessoal (para escaneamento do QR Code)

## ğŸ”§ InstalaÃ§Ã£o

### 1. Clone e Configure o Servidor WhatsApp

```bash
# Clone ou baixe os arquivos
cd whats-hub

# Instale as dependÃªncias
npm install whatsapp-web.js express qrcode axios

# Configure as variÃ¡veis de ambiente (opcional)
export N8N_WEBHOOK_URL="http://localhost:5678/webhook/whatsapp-messages"
export PORT=3001
```

### 2. Configure o n8n

1. **Importe o Template**:
   - Abra o n8n
   - VÃ¡ em "Templates" ou "Import"
   - Importe o arquivo `template-whatsapp-webjs.json`

2. **Configure as Credenciais**:
   - **OpenAI API**: Adicione sua chave da OpenAI para transcriÃ§Ã£o e IA
   - **Webhook URL**: Certifique-se que estÃ¡ apontando para o servidor

3. **Ative o Workflow**:
   - Ative o workflow no n8n
   - Anote a URL do webhook gerada

### 3. Inicie o Servidor

```bash
# Inicie o servidor WhatsApp
node whatsapp-webjs-server.js

# Ou use nodemon para desenvolvimento
npm install -g nodemon
nodemon whatsapp-webjs-server.js
```

### 4. Conecte o WhatsApp

1. Acesse `http://localhost:3001/qr`
2. Escaneie o QR Code com seu WhatsApp
3. Aguarde a confirmaÃ§Ã£o de conexÃ£o

## ğŸ“± Como Usar

### Enviar Mensagens de Teste

ApÃ³s conectar, envie mensagens para o WhatsApp conectado:

- **Texto**: "OlÃ¡, como vocÃª estÃ¡?"
- **Ãudio**: Grave uma nota de voz
- **Imagem**: Envie uma foto
- **VÃ­deo**: Envie um vÃ­deo curto

O bot responderÃ¡ automaticamente usando IA!

### Endpoints da API

```bash
# Status do servidor
GET http://localhost:3001/status

# Ver QR Code
GET http://localhost:3001/qr

# Enviar mensagem programaticamente
POST http://localhost:3001/api/send-message
{
  "chatId": "5511999999999@c.us",
  "message": "OlÃ¡! Como posso ajudar?"
}

# Enviar mÃ­dia
POST http://localhost:3001/api/send-media
{
  "chatId": "5511999999999@c.us",
  "media": {
    "mimetype": "image/jpeg",
    "data": "base64_data_here",
    "filename": "image.jpg"
  },
  "caption": "Legenda da imagem"
}
```

## ğŸ¯ Fluxo de Funcionamento

```
ğŸ“± WhatsApp â†’ ğŸ”„ WhatsApp Web.js â†’ ğŸŒ Webhook â†’ ğŸ“Š n8n â†’ ğŸ¤– IA â†’ ğŸ“¤ Resposta
```

1. **Mensagem Recebida**: WhatsApp Web.js captura a mensagem
2. **Processamento**: Servidor processa e envia para n8n via webhook
3. **AnÃ¡lise**: n8n analisa o tipo de mensagem (texto, Ã¡udio, imagem, vÃ­deo)
4. **IA**: Processa com OpenAI/GPT-4 conforme o tipo
5. **Resposta**: n8n gera resposta inteligente
6. **Envio**: Resposta Ã© enviada de volta via WhatsApp Web.js

## ğŸ”§ ConfiguraÃ§Ãµes AvanÃ§adas

### VariÃ¡veis de Ambiente

```bash
# URL do webhook do n8n
N8N_WEBHOOK_URL=http://localhost:5678/webhook/whatsapp-messages

# Porta do servidor
PORT=3001

# Chaves da API (configure no n8n)
OPENAI_API_KEY=sk-...
```

### PersonalizaÃ§Ã£o do Bot

Edite o workflow n8n para:

- âœï¸ Mudar personalidade do bot
- ğŸ”§ Adicionar novas ferramentas/APIs  
- ğŸ¨ Customizar respostas
- ğŸ“Š Adicionar analytics
- ğŸ”’ Implementar autenticaÃ§Ã£o

### Tipos de Mensagem Suportados

| Tipo | Processamento | IA Usada |
|------|---------------|----------|
| **Texto** | Direto | GPT-4 |
| **Ãudio** | TranscriÃ§Ã£o â†’ Texto | Whisper + GPT-4 |
| **Imagem** | AnÃ¡lise visual | GPT-4 Vision |
| **VÃ­deo** | AnÃ¡lise de frames | CustomizÃ¡vel |
| **Documento** | ExtraÃ§Ã£o de texto | OCR + GPT-4 |

## ğŸ³ Docker (Opcional)

```dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3001
CMD ["node", "whatsapp-webjs-server.js"]
```

```bash
# Construir imagem
docker build -t whatsapp-webjs-server .

# Executar
docker run -p 3001:3001 -e N8N_WEBHOOK_URL="http://host.docker.internal:5678/webhook/whatsapp-messages" whatsapp-webjs-server
```

## ğŸ” Monitoramento

### Logs do Servidor
```bash
# Ver logs em tempo real
tail -f server.log

# Status via API
curl http://localhost:3001/status
```

### Logs do n8n
- Acesse a interface do n8n
- VÃ¡ em "Executions" para ver o histÃ³rico
- Monitore erros e performance

## âš ï¸ ConsideraÃ§Ãµes Importantes

### LimitaÃ§Ãµes do WhatsApp Web.js
- âš ï¸ **DetecÃ§Ã£o**: WhatsApp pode detectar o uso de bots
- ğŸ”„ **ReconexÃ£o**: Pode desconectar e precisar de nova autenticaÃ§Ã£o
- ğŸ“± **DependÃªncia**: Precisa manter o telefone conectado

### Para Uso Profissional
- ğŸ¢ **WhatsApp Business API**: Considere migrar para a API oficial
- ğŸ”’ **Compliance**: Verifique termos de uso do WhatsApp
- ğŸ“ˆ **Escalabilidade**: Para alto volume, use soluÃ§Ãµes dedicadas

### SeguranÃ§a
- ğŸ” **Credenciais**: Nunca commite chaves de API
- ğŸŒ **HTTPS**: Use HTTPS em produÃ§Ã£o
- ğŸ”’ **Firewall**: Proteja endpoints sensÃ­veis

## ğŸ› SoluÃ§Ã£o de Problemas

### QR Code nÃ£o aparece
```bash
# Deletar sessÃ£o anterior
rm -rf .wwebjs_auth/

# Reiniciar servidor
node whatsapp-webjs-server.js
```

### Mensagens nÃ£o chegam no n8n
1. Verifique se o n8n estÃ¡ rodando
2. Confirme a URL do webhook
3. Teste o endpoint manualmente:
```bash
curl -X POST http://localhost:5678/webhook/whatsapp-messages \
  -H "Content-Type: application/json" \
  -d '{"test": "message"}'
```

### Erro de transcriÃ§Ã£o de Ã¡udio
- Verifique a chave da OpenAI no n8n
- Confirme se o Ã¡udio estÃ¡ no formato correto
- Teste com Ã¡udios menores primeiro

### Performance lenta
- Aumente a memÃ³ria do Node.js: `node --max-old-space-size=4096`
- Use SSD para melhor I/O
- Configure cache no n8n

## ğŸ“š Recursos Adicionais

- [DocumentaÃ§Ã£o WhatsApp Web.js](https://wwebjs.dev/)
- [DocumentaÃ§Ã£o n8n](https://docs.n8n.io/)
- [OpenAI API Docs](https://platform.openai.com/docs)
- [Exemplos de Templates](https://n8n.io/workflows/)

## ğŸ¤ ContribuiÃ§Ã£o

Sinta-se livre para contribuir com melhorias:

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudanÃ§as
4. Abra um Pull Request

## ğŸ“„ LicenÃ§a

MIT License - veja o arquivo LICENSE para detalhes.

---

**ğŸ’¡ Dica**: Comece com mensagens simples e vÃ¡ adicionando complexidade gradualmente. O sistema Ã© muito flexÃ­vel e pode ser adaptado para diversos casos de uso!

**ğŸ†˜ Precisa de ajuda?** Abra uma issue no repositÃ³rio ou consulte a documentaÃ§Ã£o das ferramentas utilizadas.

---

## ğŸ‘¥ Sistema de Atendimento Humano AvanÃ§ado

### ğŸ¢ **Recursos da Fila de Atendimento**

#### ğŸ¯ **GestÃ£o Inteligente de Filas**
- **PriorizaÃ§Ã£o**: Urgente â†’ Alta â†’ Normal
- **MÃºltiplos Atendentes**: Suporte simultÃ¢neo para vÃ¡rios agentes
- **Auto-Assign**: DistribuiÃ§Ã£o automÃ¡tica baseada em disponibilidade
- **Tempo de Espera**: CÃ¡lculo em tempo real e estimativas
- **TransferÃªncia**: MovimentaÃ§Ã£o entre atendentes
- **HistÃ³rico Completo**: Registro de todas as interaÃ§Ãµes

#### ğŸ‘¨â€ğŸ’¼ **Gerenciamento de Atendentes**
- **Registro**: Cadastro com habilidades e especialidades
- **Status**: Available, Busy, Away
- **Capacidade**: Limite configurÃ¡vel de chats simultÃ¢neos
- **MÃ©tricas**: EstatÃ­sticas individuais de performance
- **Skills Matching**: Direcionamento baseado em competÃªncias

#### ğŸ“Š **Analytics e MÃ©tricas**
- **Tempo de Espera MÃ©dio**: Monitoramento contÃ­nuo
- **DuraÃ§Ã£o de Atendimento**: AnÃ¡lise de eficiÃªncia
- **SatisfaÃ§Ã£o do Cliente**: AvaliaÃ§Ãµes 1-5 com feedback
- **Volume de Atendimentos**: EstatÃ­sticas diÃ¡rias/mensais
- **Performance de Atendentes**: Rankings e insights

### ğŸ”„ **Fluxo do Cliente na Fila**

```mermaid
graph TD
    A[Cliente solicita atendimento] --> B[Adiciona Ã  fila com prioridade]
    B --> C[Recebe posiÃ§Ã£o e tempo estimado]
    C --> D{Atendente disponÃ­vel?}
    D -->|Sim| E[Inicia chat com atendente]
    D -->|NÃ£o| F[Aguarda na fila]
    F --> G[Recebe atualizaÃ§Ãµes de posiÃ§Ã£o]
    G --> D
    E --> H[Chat ativo com atendente]
    H --> I[Cliente pode avaliar atendimento]
    I --> J[Chat finalizado]
```

### ğŸ› ï¸ **APIs REST Completas**

#### ğŸ“ **Endpoints Principais**

| MÃ©todo | Endpoint | DescriÃ§Ã£o |
|--------|----------|-----------|
| GET | `/api/support-queue` | Status detalhado da fila |
| POST | `/api/support-queue/register-attendant` | Registrar atendente |
| PUT | `/api/support-queue/attendant-status` | Atualizar status |
| POST | `/api/support-queue/start-chat` | Iniciar atendimento |
| POST | `/api/support-queue/end-chat` | Finalizar atendimento |
| POST | `/api/support-queue/send-message` | Enviar mensagem |
| POST | `/api/support-queue/transfer` | Transferir chat |
| GET | `/api/support-queue/chat-history/:chatId` | HistÃ³rico do chat |
| POST | `/api/support-queue/auto-assign` | Auto-atribuiÃ§Ã£o |

#### ğŸ”§ **Exemplos de Uso das APIs**

##### Registrar Atendente
```bash
curl -X POST http://localhost:3001/api/support-queue/register-attendant \
  -H "Content-Type: application/json" \
  -d '{
    "attendantId": "agent001",
    "attendantName": "JoÃ£o Silva",
    "skills": ["vendas", "suporte tÃ©cnico"]
  }'
```

##### Iniciar Chat
```bash
curl -X POST http://localhost:3001/api/support-queue/start-chat \
  -H "Content-Type: application/json" \
  -d '{
    "attendantId": "agent001",
    "attendantName": "JoÃ£o Silva"
  }'
```

##### Enviar Mensagem do Atendente
```bash
curl -X POST http://localhost:3001/api/support-queue/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "chatId": "5511999999999@c.us",
    "message": "OlÃ¡! Como posso ajudÃ¡-lo?",
    "attendantId": "agent001"
  }'
```

##### Finalizar Atendimento
```bash
curl -X POST http://localhost:3001/api/support-queue/end-chat \
  -H "Content-Type: application/json" \
  -d '{
    "chatId": "5511999999999@c.us",
    "attendantId": "agent001",
    "rating": 5,
    "feedback": "Excelente atendimento!"
  }'
```

### ğŸ–¥ï¸ **Dashboard de Atendimento**

#### ğŸ“Š **Recursos do Dashboard**
- **Fila em Tempo Real**: VisualizaÃ§Ã£o de todos os clientes aguardando
- **Chats Ativos**: Monitoramento de atendimentos em andamento
- **MÃ©tricas Live**: EstatÃ­sticas atualizadas automaticamente
- **GestÃ£o de Atendentes**: Status e disponibilidade da equipe
- **HistÃ³rico de Atendimentos**: Registros completos com avaliaÃ§Ãµes

#### ğŸŒ **Acesso aos Dashboards**
- **Dashboard Geral**: `http://localhost:3001/dashboard`
- **Dashboard de Atendimento**: `http://localhost:3001/support-dashboard`
- **QR Code**: `http://localhost:3001/qr`
- **Status JSON**: `http://localhost:3001/status`

### ğŸ”’ **SeguranÃ§a e Boas PrÃ¡ticas**

#### ğŸ›¡ï¸ **Medidas de SeguranÃ§a Implementadas**
- **Rate Limiting**: ProteÃ§Ã£o contra spam e abuso
- **SanitizaÃ§Ã£o**: Limpeza de inputs maliciosos
- **AutenticaÃ§Ã£o**: Controle de acesso aos endpoints
- **Logs de Auditoria**: Rastreamento completo de aÃ§Ãµes
- **Backup AutomÃ¡tico**: Estados salvos a cada 5 minutos

#### âš¡ **OtimizaÃ§Ãµes de Performance**
- **Cache de Estados**: Acesso rÃ¡pido aos dados do usuÃ¡rio
- **Processamento AssÃ­ncrono**: OperaÃ§Ãµes nÃ£o-bloqueantes
- **Limpeza AutomÃ¡tica**: RemoÃ§Ã£o de sessÃµes expiradas
- **Pooling de ConexÃµes**: Gerenciamento eficiente de recursos

### ğŸ›ï¸ **ConfiguraÃ§Ãµes AvanÃ§adas**

#### âš™ï¸ **VariÃ¡veis de Ambiente**
```bash
# URLs e Portas
PORT=3001
N8N_WEBHOOK_URL=http://localhost:5678/webhook/whatsapp-messages

# Timeouts e Limites
SESSION_TIMEOUT_MS=1800000  # 30 minutos
MAX_CHATS_PER_ATTENDANT=3
QUEUE_PRIORITY_LEVELS=3

# SeguranÃ§a
ENABLE_RATE_LIMITING=true
MAX_REQUESTS_PER_MINUTE=60
API_KEY_REQUIRED=false

# Backup e PersistÃªncia
AUTO_BACKUP_INTERVAL=300000  # 5 minutos
MAX_CHAT_HISTORY=100
ENABLE_CHAT_TRANSCRIPTS=true
```

#### ğŸ”„ **IntegraÃ§Ã£o com CRM/BI**
```javascript
// Webhook para integraÃ§Ã£o externa
app.post('/webhook/chat-completed', (chatData) => {
  // Enviar dados para CRM
  await sendToCRM(chatData);
  
  // Atualizar BI/Analytics
  await updateAnalytics(chatData);
  
  // Notificar sistemas externos
  await notifyExternalSystems(chatData);
});
```

### ğŸ“ˆ **Monitoramento e MÃ©tricas**

#### ğŸ¯ **KPIs Principais**
- **First Response Time**: Tempo para primeiro atendimento
- **Resolution Time**: Tempo total de resoluÃ§Ã£o
- **Customer Satisfaction Score (CSAT)**: MÃ©dia de avaliaÃ§Ãµes
- **Queue Abandonment Rate**: Taxa de desistÃªncia na fila
- **Attendant Utilization**: Taxa de ocupaÃ§Ã£o dos agentes
- **Chat Volume**: Volume de atendimentos por perÃ­odo

#### ğŸ“Š **Exemplo de Resposta da API de Status**
```json
{
  "queueLength": 3,
  "activeChats": 5,
  "availableAttendants": 2,
  "totalAttendants": 4,
  "averageWaitTimeMinutes": 8,
  "statistics": {
    "totalChatsToday": 45,
    "averageWaitTimeMinutes": 12,
    "averageChatDurationMinutes": 15,
    "customerSatisfaction": 4.2,
    "uptime": 480
  },
  "queue": [
    {
      "position": 1,
      "chatId": "5511999999999@c.us",
      "userName": "Maria Silva",
      "priority": "high",
      "topic": "suporte tÃ©cnico",
      "waitingTimeMinutes": 15
    }
  ],
  "attendants": [
    {
      "id": "agent001",
      "name": "JoÃ£o Silva",
      "status": "available",
      "activeChats": 2,
      "totalChatsToday": 12
    }
  ]
}
```
